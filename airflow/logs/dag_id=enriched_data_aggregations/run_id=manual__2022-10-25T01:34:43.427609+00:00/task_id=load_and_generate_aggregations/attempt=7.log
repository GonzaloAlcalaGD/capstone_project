[2022-10-25T02:15:57.074+0000] {taskinstance.py:1165} INFO - Dependencies all met for <TaskInstance: enriched_data_aggregations.load_and_generate_aggregations manual__2022-10-25T01:34:43.427609+00:00 [failed]>
[2022-10-25T02:15:57.104+0000] {taskinstance.py:1165} INFO - Dependencies all met for <TaskInstance: enriched_data_aggregations.load_and_generate_aggregations manual__2022-10-25T01:34:43.427609+00:00 [failed]>
[2022-10-25T02:15:57.106+0000] {taskinstance.py:1362} INFO - 
--------------------------------------------------------------------------------
[2022-10-25T02:15:57.108+0000] {taskinstance.py:1363} INFO - Starting attempt 7 of 2
[2022-10-25T02:15:57.109+0000] {taskinstance.py:1364} INFO - 
--------------------------------------------------------------------------------
[2022-10-25T02:15:57.135+0000] {taskinstance.py:1383} INFO - Executing <Task(PythonOperator): load_and_generate_aggregations> on 2022-10-25 01:34:43.427609+00:00
[2022-10-25T02:15:57.147+0000] {standard_task_runner.py:54} INFO - Started process 14665 to run task
[2022-10-25T02:15:57.159+0000] {standard_task_runner.py:82} INFO - Running: ['***', 'tasks', 'run', 'enriched_data_aggregations', 'load_and_generate_aggregations', 'manual__2022-10-25T01:34:43.427609+00:00', '--job-id', '593', '--pool', 'default_pool', '--raw', '--subdir', 'DAGS_FOLDER/data_agg.py', '--cfg-path', '/tmp/tmpuja4dr3e']
[2022-10-25T02:15:57.162+0000] {standard_task_runner.py:83} INFO - Job 593: Subtask load_and_generate_aggregations
[2022-10-25T02:15:57.168+0000] {dagbag.py:525} INFO - Filling up the DagBag from /opt/***/dags/data_agg.py
[2022-10-25T02:15:57.445+0000] {task_command.py:384} INFO - Running <TaskInstance: enriched_data_aggregations.load_and_generate_aggregations manual__2022-10-25T01:34:43.427609+00:00 [running]> on host 0c46e38e1c8e
[2022-10-25T02:15:57.724+0000] {taskinstance.py:1592} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_OWNER=***
AIRFLOW_CTX_DAG_ID=enriched_data_aggregations
AIRFLOW_CTX_TASK_ID=load_and_generate_aggregations
AIRFLOW_CTX_EXECUTION_DATE=2022-10-25T01:34:43.427609+00:00
AIRFLOW_CTX_TRY_NUMBER=7
AIRFLOW_CTX_DAG_RUN_ID=manual__2022-10-25T01:34:43.427609+00:00
[2022-10-25T02:16:42.176+0000] {pyspark_scripts.py:280} INFO - Working in  - Count and sum amount transactions for each type for day, online & offline - 
[2022-10-25T02:16:58.935+0000] {logging_mixin.py:117} INFO - +----+----------+------------------+------------------+
|type| timestamp|total_transactions|             total|
+----+----------+------------------+------------------+
|   1|2022-10-18|                72| 550923.8766937256|
|   1|2022-10-16|                52| 770093.0860799551|
|   1|2022-10-17|                86| 1133092.203715682|
|   1|2022-10-14|                 7| 11244.01019513607|
|   1|2022-10-19|                36|266427.68115758896|
|   1|2022-10-15|                43|396290.55984020233|
|   0|2022-10-15|                27|200340.61073350906|
|   0|2022-10-19|                38| 514774.3481952846|
|   0|2022-10-14|                 2|43246.169843673706|
|   0|2022-10-18|                62| 669039.1448940039|
|   0|2022-10-17|                64|  577018.139827162|
|   0|2022-10-16|                45|371993.34034085274|
+----+----------+------------------+------------------+
[2022-10-25T02:16:59.189+0000] {pyspark_scripts.py:284} INFO - Working in - Count and sum transaction for each store for day -
[2022-10-25T02:17:01.601+0000] {logging_mixin.py:117} INFO - +--------+----------+-----+------------------+
|store_id| timestamp|count|             total|
+--------+----------+-----+------------------+
|       1|2022-10-18|    8|10352.989694237709|
|       1|2022-10-17|    9|119570.40901470184|
|       1|2022-10-14|    1|2036.3199462890625|
|       1|2022-10-16|    4|28318.500908136368|
|       1|2022-10-19|    5|4569.1801171302795|
|       1|2022-10-15|    3| 962.9299945831299|
|       2|2022-10-15|    3|3055.6300048828125|
|       2|2022-10-18|    7|101182.96770095825|
|       2|2022-10-17|   11|145505.63321065903|
|       2|2022-10-16|    3|36578.051067352295|
|       2|2022-10-14|    1|18.209999084472656|
|       2|2022-10-19|    5| 71361.62062549591|
|       3|2022-10-15|    3|57261.348278045654|
|       3|2022-10-18|    1| 9.600000381469727|
|       3|2022-10-17|   11| 74678.83226513863|
|       3|2022-10-19|    1| 850.0900268554688|
|       3|2022-10-16|    4|156817.66723632812|
|       4|2022-10-15|    3| 9987.270000457764|
|       4|2022-10-14|    1|31.979999542236328|
|       4|2022-10-18|    9|149833.60688352585|
|       4|2022-10-16|    5|  10894.4195895195|
|       4|2022-10-17|    7|209389.56054472923|
|       5|2022-10-19|    3| 58649.86976623535|
|       5|2022-10-15|    5| 53211.78977203369|
|       5|2022-10-16|    2|501.17999029159546|
|       5|2022-10-14|    1|    43239.58984375|
|       5|2022-10-17|   13|172028.35660499334|
|       5|2022-10-18|    5|129.51999962329865|
|       6|2022-10-14|    1| 285.6000061035156|
|       6|2022-10-18|    9|117157.16052913666|
|       6|2022-10-19|    5|16158.570039272308|
|       6|2022-10-17|    4| 87175.67363548279|
|       6|2022-10-15|    3|1022.2599868774414|
|       6|2022-10-16|    8| 88998.46258842945|
|       7|2022-10-16|    7|18869.030132055283|
|       7|2022-10-18|    3| 902.7800009250641|
|       7|2022-10-19|    4| 29454.06005859375|
|       7|2022-10-15|    8| 63826.19953632355|
|       7|2022-10-17|    9|105273.91103222966|
|       8|2022-10-18|    3| 7084.510039806366|
|       8|2022-10-15|    3|15810.619902133942|
|       8|2022-10-16|    4|   123905.94921875|
|       8|2022-10-19|    1|   16092.099609375|
|       8|2022-10-17|    9| 95706.64986467361|
|       8|2022-10-14|    1|  424.010009765625|
|       9|2022-10-15|    4|  4731.47989654541|
|       9|2022-10-19|    4|1092.4500198364258|
|       9|2022-10-17|    5| 42429.65107917786|
|       9|2022-10-16|    6|1575.9500288963318|
|       9|2022-10-18|    5|22276.180154561996|
+--------+----------+-----+------------------+
only showing top 50 rows
[2022-10-25T02:17:01.781+0000] {pyspark_scripts.py:288} INFO - Working in - Count and sum amount transactions for each city for day -
[2022-10-25T02:17:03.776+0000] {logging_mixin.py:117} INFO - +-----------------+----------+-----+------------------+
|          address| timestamp|count|             total|
+-----------------+----------+-----+------------------+
|       Averymouth|2022-10-14|    1|18.209999084472656|
|         Clayview|2022-10-14|    1|2036.3199462890625|
|      Veronicaton|2022-10-14|    2| 8732.340240478516|
|         Allenton|2022-10-14|    1| 1.149999976158142|
|      Melissafurt|2022-10-14|    1|    43239.58984375|
|        Erikville|2022-10-14|    1|31.979999542236328|
|  Lake Jamesville|2022-10-14|    1|  424.010009765625|
|        Smithberg|2022-10-14|    1| 6.579999923706055|
|     Edwardsburgh|2022-10-15|    2| 85.59000205993652|
|        Erikville|2022-10-15|    8|  96046.5398440361|
|Port Benjaminfurt|2022-10-15|    4|147164.49407196045|
|        Hicksview|2022-10-15|    1| 7.679999828338623|
|        Smithberg|2022-10-15|    5| 970.9299983978271|
|       Grahamstad|2022-10-15|    3|16911.399780273438|
|      Lake Karina|2022-10-15|    1|22.110000610351562|
|      Melissafurt|2022-10-15|    3| 64363.41046142578|
|         Allenton|2022-10-15|    2| 99.45000076293945|
|       Robertland|2022-10-15|    8| 53412.12080526352|
|     Brownchester|2022-10-15|    3|1551.8599467277527|
|New Marthaborough|2022-10-15|    4| 3035.859914302826|
|    Port Loriview|2022-10-15|    2|409.02999687194824|
|     West Nichole|2022-10-15|    6| 2574.349998474121|
|  Lake Jamesville|2022-10-15|    5| 8427.969718933105|
|         Lanefurt|2022-10-15|    4| 63444.50950241089|
|    Michelleburgh|2022-10-15|    5| 72669.64833068848|
|         Clayview|2022-10-15|    2| 57692.80828857422|
|      Veronicaton|2022-10-15|    2| 7741.409912109375|
|    Port Loriview|2022-10-16|    4| 944.6400161981583|
|       Grahamstad|2022-10-16|    9| 60202.73887467384|
|  Lake Jamesville|2022-10-16|    1|   9708.2099609375|
|     Edwardsburgh|2022-10-16|    6|52725.360778808594|
|        Erikville|2022-10-16|    6|173430.48718595505|
|         Clayview|2022-10-16|    6|111962.48211288452|
|      Lake Karina|2022-10-16|    5|154122.53289055824|
|     West Nichole|2022-10-16|    5|41759.101170539856|
|Port Benjaminfurt|2022-10-16|    5|126059.74975585938|
|       Robertland|2022-10-16|    6| 78977.16931915283|
|New Marthaborough|2022-10-16|    7| 20727.07021713257|
|    Michelleburgh|2022-10-16|    6| 16788.89025402069|
|        Smithberg|2022-10-16|    4|105585.90198230743|
|      Veronicaton|2022-10-16|    7| 96883.37220478058|
|     Brownchester|2022-10-16|    3| 3994.929919242859|
|        Hicksview|2022-10-16|    2|    14802.41015625|
|       Averymouth|2022-10-16|    4| 7971.470085144043|
|         Lanefurt|2022-10-16|    5| 7294.179852962494|
|         Allenton|2022-10-16|    1|128.14999389648438|
|      Melissafurt|2022-10-16|    5|58017.579689502716|
|      Veronicaton|2022-10-17|    5|28870.199575424194|
|        Erikville|2022-10-17|    8| 73987.98110961914|
|New Marthaborough|2022-10-17|    5| 98859.23029637337|
+-----------------+----------+-----+------------------+
only showing top 50 rows
[2022-10-25T02:17:11.775+0000] {taskinstance.py:1851} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/operators/python.py", line 175, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/operators/python.py", line 193, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/pyspark_scripts.py", line 293, in load_and_aggregate
    cities_transactions.mode('overwrite').parquet(f'{save_path}/cities_transactions')
  File "/home/airflow/.local/lib/python3.7/site-packages/pyspark/sql/dataframe.py", line 1989, in __getattr__
    "'%s' object has no attribute '%s'" % (self.__class__.__name__, name)
AttributeError: 'DataFrame' object has no attribute 'mode'
[2022-10-25T02:17:11.932+0000] {taskinstance.py:1406} INFO - Marking task as FAILED. dag_id=enriched_data_aggregations, task_id=load_and_generate_aggregations, execution_date=20221025T013443, start_date=20221025T021557, end_date=20221025T021711
[2022-10-25T02:17:12.003+0000] {standard_task_runner.py:107} ERROR - Failed to execute job 593 for task load_and_generate_aggregations ('DataFrame' object has no attribute 'mode'; 14665)
[2022-10-25T02:17:12.084+0000] {local_task_job.py:164} INFO - Task exited with return code 1
[2022-10-25T02:17:12.295+0000] {local_task_job.py:273} INFO - 0 downstream tasks scheduled from follow-on schedule check
